<div class="file-list-container">
    <div class="list-header">
        <h2 class="section-title">Mes fichiers</h2>

        <div class="filters">
            <button [class.active]="filter === 'all'" (click)="setFilter('all')">Tous</button>
            <button [class.active]="filter === 'active'" (click)="setFilter('active')">Actifs</button>
            <button [class.active]="filter === 'expired'" (click)="setFilter('expired')">Expir√©</button>

            <div class="tag-search">
                <input type="text" placeholder="üîç  Rechercher par tag..." [(ngModel)]="tagFilter" class="search-input">
            </div>
        </div>
    </div>

    <div *ngIf="message" class="alert alert-success">{{ message }}</div>

    <div class="files-rows">
        <div class="file-row" *ngFor="let file of filteredFiles" [class.expired]="isExpired(file)">
            <div class="file-icon">
                üìÑ <!-- Could be dynamic based on extension -->
            </div>

            <div class="file-details">
                <div class="file-name">{{ file.originalName }}</div>
                <div class="file-status" [class.status-expired]="isExpired(file)">
                    {{ getExpirationText(file) }}
                </div>

                <!-- TAGS SECTION -->
                <div class="tags-container" *ngIf="!isExpired(file)">
                    <div class="tag-badge" *ngFor="let tag of file.tags">
                        {{ tag }}
                        <span class="remove-tag" (click)="removeTag(file, tag)">√ó</span>
                    </div>

                    <div class="add-tag-wrapper">
                        <input type="text" placeholder="+ Tag" class="tag-input" (keydown.enter)="addTag(file, $event)"
                            maxlength="30">
                    </div>
                </div>
            </div>

            <div class="spacer"></div>

            <div class="download-count" *ngIf="!isExpired(file)">
                Nombre de t√©l√©chargements : {{ file.downloadCount || 0 }}
            </div>

            <div class="file-status-text" *ngIf="isExpired(file)">
                Ce fichier √† expir√©, il n'est plus stock√© chez nous
            </div>

            <div class="file-actions" *ngIf="!isExpired(file)">
                <button class="btn-action delete" (click)="openDeleteModal(file.id)">
                    üóëÔ∏è Supprimer
                </button>
                <button class="btn-action share" (click)="copyLink(file.shareToken, $event)">
                    üîó Copier le lien
                </button>
            </div>
            <!-- Allow delete even if expired to clean up list -->
            <div class="file-actions" *ngIf="isExpired(file)">
                <button class="btn-action delete" (click)="openDeleteModal(file.id)">
                    üóëÔ∏è Supprimer
                </button>
            </div>
        </div>

        <div *ngIf="filteredFiles.length === 0" class="empty-state">
            Aucun fichier correspondant.
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay" *ngIf="showDeleteModal" (click)="cancelDelete()">
        <div class="modal-card" (click)="$event.stopPropagation()">
            <h3>Confirmer la suppression</h3>
            <p>√ätes-vous s√ªr de vouloir supprimer ce fichier ? Cette action est irr√©versible.</p>
            <div class="modal-actions">
                <button class="btn-cancel" (click)="cancelDelete()">Annuler</button>
                <button class="btn-confirm" (click)="confirmDelete()">Oui, supprimer</button>
            </div>
        </div>
    </div>
</div>